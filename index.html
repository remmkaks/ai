<!DOCTYPE html>
<html lang="et">
<head>
  <meta charset="UTF-8">
  <title>Linkide kataloog</title>
  <script src="https://cdn.jsdelivr.net/npm/list.js@2.3.1/dist/list.min.js"></script>
  <style>
body {
  font-family: 'Segoe UI', Arial, sans-serif;
  margin: 0;
  padding: 15px;
  background-color: #f7f9fc;
  color: #333;
}

table {
  width: 100%;
  border-collapse: collapse;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  border-radius: 6px;
  overflow: hidden;
  background: white;
}

th, td {
  padding: 10px;
  text-align: left;
  border-bottom: 1px solid #eee;
  word-wrap: break-word;
}

th {
  background-color: #2b3e50;
  color: white;
  text-transform: uppercase;
  font-size: 12px;
}

tr:hover {
  background-color: #f1f6fd;
}

.badge {
  padding: 3px 8px;
  border-radius: 12px;
  font-size: 12px;
  color: white;
  font-weight: bold;
}

.High { background-color: #e74c3c; }
.Medium { background-color: #f39c12; }
.Light { background-color: #27ae60; }

.search, select {
  padding: 8px;
  margin-bottom: 10px;
  border-radius: 5px;
  border: 1px solid #ccc;
  width: 100%;
  box-sizing: border-box;
}

/* Mobiilivaade */
@media only screen and (max-width: 700px) {
  table, thead, tbody, th, td, tr {
    display: block;
  }

  thead tr {
    display: none;
  }

  tr {
    margin-bottom: 15px;
    border-radius: 8px;
    border: 1px solid #ddd;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }

  td {
    position: relative;
    padding-left: 40%;
    text-align: left;
    border-bottom: 1px solid #eee;
  }

  td::before {
    content: attr(data-label);
    position: absolute;
    left: 10px;
    width: 35%;
    padding-right: 10px;
    font-weight: bold;
    color: #555;
  }

  td:last-child {
    border-bottom: none;
  }
}
</style>
</head>
<body>

<div id="linkList">
  <input class="search" placeholder="Otsi linki, tüüpi, valdkonda või kirjeldust..." />

  <select id="importanceFilter">
    <option value="">Kõik olulisused</option>
    <option>High</option>
    <option>Medium</option>
    <option>Light</option>
  </select>

  <table>
    <thead>
      <tr>
        <th>Jk</th>
        <th>Link</th>
        <th>Tüüp</th>
        <th>Kirjeldus</th>
        <th>Valdkond</th>
        <th>Olulisus</th>
      </tr>
    </thead>
    <tbody class="list">
      <tr><td colspan="6">Laadin...</td></tr>
    </tbody>
  </table>
</div>

<script>
  async function fetchCSV() {
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQNo7nXc6z6G43Wk0lwJ12z4uj0SPRdv467Nks8vO3UbHdmfVlnx1_xaIgLUc6kbWyzCE8H8pOm-6_7/pub?output=csv';
    const response = await fetch(csvUrl);
    const data = await response.text();
    const rows = data.split("\n").slice(1);
    return rows.map(row => {
      const [jk, link, tyyp, kirjeldus, valdkond, olulisus] = row.split(",");
      return { jk, link, tyyp, kirjeldus, valdkond, olulisus };
    }).filter(link => link.jk && link.link);
  }

  async function initList() {
    const links = await fetchCSV();
    const tbody = document.querySelector('.list');
    tbody.innerHTML = '';

    links.forEach(link => {
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td class="jk" data-label="Jk">${link.jk.trim()}</td>
    <td class="link" data-label="Link"><a href="${link.link.trim()}" target="_blank">${link.link.trim()}</a></td>
    <td class="tyyp" data-label="Tüüp">${link.tyyp.trim()}</td>
    <td class="kirjeldus" data-label="Kirjeldus">${link.kirjeldus.trim()}</td>
    <td class="valdkond" data-label="Valdkond">${link.valdkond.trim()}</td>
    <td class="olulisus" data-label="Olulisus">
      <span class="badge ${link.olulisus.trim()}">${link.olulisus.trim()}</span>
    </td>
  `;
  tbody.appendChild(tr);
});
    const options = {
      valueNames: ['jk', 'link', 'tyyp', 'kirjeldus', 'valdkond', 'olulisus']
    };

    const linkList = new List('linkList', options);

    document.getElementById('importanceFilter').addEventListener('change', function() {
      const importance = this.value;
      linkList.filter(item => {
        if (!importance) return true;
        return item.values().olulisus === importance;
      });
    });
  }

  initList();
</script>

</body>
</html>
